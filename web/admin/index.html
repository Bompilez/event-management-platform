<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin – Arrangement</title>

  <link rel="stylesheet" href="./admin.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,400,0,0" />

  <!-- Quill -->
  <link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet" />
</head>
<body>

  <main class="page">
    <section id="adminPanel" hidden>
    <!-- Top bar / actions -->
    <div class="admin-topbar">
      <div class="brand">
        <img src="./admin-assets/Campus-KSU-horizon-Grønn-5615.svg" alt="Campus Kristiansund" />
      </div>
      <div class="admin-topbar-actions">
        <button class="icon-btn bell" id="btnBell" type="button" aria-label="Nye arrangementer">
          <span class="material-symbols-outlined bell-icon" aria-hidden="true">notifications</span>
          <span class="bell-badge" id="notifBadge" hidden>0</span>
        </button>
        <div class="notif-panel" id="notifPanel" hidden>
          <div class="notif-head">Nye arrangementer</div>
          <div class="notif-list" id="notifList"></div>
          <div class="notif-empty" id="notifEmpty" hidden>Ingen nye arrangementer.</div>
        </div>
        <button class="btn" id="btnMailRecipients" type="button">E‑postvarsler</button>
        <button class="btn" id="btnLogout" type="button">Logg ut</button>
      </div>
    </div>
    <div id="adminLoading" class="loading-overlay" aria-hidden="true">
      <div class="loading-card">
        <div class="spinner" aria-hidden="true"></div>
        <div>Laster...</div>
      </div>
    </div>
    <header class="topbar">
      <h1>Arrangementer</h1>
      <div class="topbar-actions">
        <button class="btn btn-primary" id="btnNew">+ Nytt arrangement</button>
      </div>
    </header>

    <!-- List + filters -->
    <section class="table-wrap">
      <div class="table-head">
        <div class="filters">
          <button class="chip is-active" data-filter="all">Alle</button>
          <button class="chip" data-filter="draft">Til vurdering</button>
          <button class="chip" data-filter="published">Publisert</button>
          <button class="chip" data-filter="archived">Ferdige</button>
        </div>

        <div class="search">
          <input id="search" class="input" placeholder="Søk på tittel / arrangør / sted…" />
        </div>
      </div>

      <div id="list" class="list"></div>

      <div id="emptyState" class="empty" hidden>
        <p><strong>Ingen arrangementer</strong></p>
        <p>Det er ingen treff for filteret ditt akkurat nå.</p>
      </div>
    </section>
    </section>
  </main>

  <!-- Edit modal -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" data-close="1"></div>

    <div class="modal-panel" role="dialog" aria-modal="true" aria-label="Rediger arrangement">
      <div class="modal-header">
        <div class="modal-title">
          <h2 id="modalTitle">Rediger arrangement</h2>
          <p class="muted" id="modalSub">Oppdater innhold og detaljer</p>
          <p class="muted" id="modalId"></p>
          <div id="lockBanner" class="lock-banner" hidden>
            <span class="lock-dot" aria-hidden="true"></span>
            <span id="lockBannerText"></span>
          </div>
        </div>

        <button class="icon-btn" data-close="1" aria-label="Lukk">✕</button>
      </div>

      <div class="modal-body">
        <form id="form" class="form">
          <div class="form-grid">
            <div class="form-left">

              <div class="field">
                <label for="title">Tittel</label>
                <input id="title" class="input" autocomplete="off" />
              </div>

              <div class="grid2">
                <div class="field" id="slugField">
                  <label for="slug">Slug / URL</label>
                  <input id="slug" class="input" autocomplete="off" />
                  <small class="hint">Eks: <code>apen-dag-pa-campus</code></small>
                </div>

              <div class="field">
                <label for="organizerName">Arrangørnavn</label>
                <input id="organizerName" class="input" autocomplete="off" />
              </div>
            </div>

              <!-- Quill editor -->
              <div class="field">
                <label for="contentEditor">Brødtekst</label>
                <div class="quill-wrap">
                  <div id="contentEditor" class="quill-editor"></div>
                </div>

                <input type="hidden" id="content" name="content"/>
              </div>

                <div class="field">
                  <label class="toggle">
                    <input type="checkbox" id="showProgram" checked />
                    <span>Legg til program (valgfritt)</span>
                  </label>
                </div>

              <div id="programBlock">
                <div class="program">
                  <div class="program-head">
                    <h3>Program</h3>
                    <button type="button" class="btn" id="btnAddProgram">Legg til punkt</button>
                  </div>

                  <div id="programRows" class="program-rows"></div>

                  <template id="tplProgramRow">
                    <div class="program-row">
                      <input class="input program-time" placeholder="12:00" />
                      <input class="input program-text" placeholder="Velkommen" />
                      <button type="button" class="icon-btn danger program-remove" title="Fjern">✕</button>
                    </div>
                  </template>
                </div>
              </div>

            </div>

            <!-- HØYRE: DETALJER -->
            <aside class="form-right">
              <div class="card">
                <div class="card-title">Detaljer</div>

                <div class="grid2">
                  <div class="field stacked">
                    <label for="status">Status</label>
                    <select id="status" class="select">
                      <option value="draft">Utkast</option>
                      <option value="published">Publiser</option>
                      <option value="archived">Ferdig</option>
                    </select>
                  </div>

                </div>

                <div class="field">
                  <label for="startAt">Dato</label>
                  <input id="startAt" type="date" class="input" />
                </div>

                <div class="grid2">
                  <div class="field">
                    <label for="startTime">Fra</label>
                    <input id="startTime" class="input" placeholder="12:00" />
                  </div>
                  <div class="field">
                    <label for="endTime">Til</label>
                    <input id="endTime" class="input" placeholder="14:00" />
                  </div>
                </div>

                <div class="grid3">
                  <div class="field">
                    <label for="location">Sted</label>
                    <input id="location" class="input" />
                  </div>
                  <div class="field">
                    <label for="room">Rom</label>
                    <input id="room" class="input" />
                  </div>
                  <div class="field">
                    <label for="floor">Etasje</label>
                    <input id="floor" class="input" />
                  </div>
                </div>

                <div class="field">
                  <label class="label">Bilde</label>
                  <label class="image-drop" for="adminImageFile">
                    <input id="adminImageFile" type="file" accept="image/jpeg,image/png,image/webp" />
                    <span class="image-drop-icon" aria-hidden="true">+</span>
                    <span class="image-drop-text">Klikk for å laste opp nytt bilde</span>
                    <span class="image-drop-sub">Maks 4 MB. Bildet må være liggende format.</span>
                  </label>
                  <p id="adminImageError" class="hint is-error" style="display:none;"></p>
                  <div class="img-preview">
                    <img id="imagePreview" alt="" />
                  </div>
                  <div class="preview-actions" id="removeImageWrap" style="display:none;">
                    <button class="btn btn-ghost" type="button" id="btnRemoveImage">Fjern bilde</button>
                  </div>
                </div>

                <div class="field">
                  <label class="label">Logo (PNG)</label>
                  <label class="image-drop" for="adminLogoFile">
                    <input id="adminLogoFile" type="file" accept="image/png" />
                    <span class="image-drop-icon" aria-hidden="true">+</span>
                    <span class="image-drop-text">Klikk for å laste opp logo</span>
                    <span class="image-drop-sub">Maks 2 MB. Hvit eller transparent bakgrunn.</span>
                  </label>
                  <p id="adminLogoError" class="hint is-error" style="display:none;"></p>
                  <div class="logo-preview">
                    <img id="logoPreview" alt="" />
                  </div>
                  <div class="preview-actions" id="removeLogoWrap" style="display:none;">
                    <button class="btn btn-ghost" type="button" id="btnRemoveLogo">Fjern logo</button>
                  </div>
                </div>

                <div class="field">
                  <label class="toggle">
                    <input type="checkbox" id="showPriceCapacity" />
                    <span>Legg til pris og kapasitet (valgfritt)</span>
                  </label>
                </div>

                <div id="priceCapacityBlock">
                  <div class="grid2">
                    <div class="field">
                      <label for="price">Pris</label>
                      <input id="price" type="number" class="input" placeholder="0" />
                    </div>
                    <div class="field">
                      <label for="capacity">Kapasitet</label>
                      <input id="capacity" type="number" class="input" placeholder="25" />
                    </div>
                  </div>
                </div>

                <div class="field">
                  <label class="toggle">
                    <input type="checkbox" id="showCta" />
                    <span>Legg til påmeldingslenke (valgfritt)</span>
                  </label>
                </div>

                <div id="ctaBlock">
                  <div class="grid2">
                    <div class="field">
                      <label for="ctaUrl">Påmledings-lenke</label>
                      <input id="ctaUrl" class="input" placeholder="https://…" />
                    </div>
                  </div>
                </div>

                <div class="field">
                  <div class="field">
                    <label for="organizerUrl">Arrangør hjemmesideadresse</label>
                    <input id="organizerUrl" class="input" placeholder="https://…" />
                  </div>
                </div>

                <div class="field">
                  <label class="toggle">
                    <input type="checkbox" id="calendarEnabled" />
                    <span>Kalender</span>
                  </label>
                </div>

                <div class="field">
                  <label class="toggle">
                    <input type="checkbox" id="shareEnabled" />
                    <span>Deling</span>
                  </label>
                </div>


                <div class="timestamps">
                  <div><span class="muted">Opprettet:</span> <span id="createdAtText">—</span></div>
                  <div><span class="muted">Oppdatert:</span> <span id="updatedAtText">—</span></div>
                </div>

                <div class="contact-box">
                  <div class="card-title">Kontaktinfo (innsender)</div>
                  <div class="field">
                    <label for="contactName">Fullt navn</label>
                    <input id="contactName" class="input" />
                  </div>
                  <div class="field">
                    <label for="contactEmail">E-post</label>
                    <input id="contactEmail" class="input" />
                  </div>
                  <div class="field">
                    <label for="contactPhone">Telefon</label>
                    <input id="contactPhone" class="input" />
                  </div>
                  <div class="field">
                    <label for="contactOrg">Organisasjon</label>
                    <input id="contactOrg" class="input" />
                  </div>
                </div>
              </div>
            </aside>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn danger" id="btnDelete" type="button">Slett</button>
        <div class="spacer"></div>
        <div id="shareLinksBlock" class="share-links" style="display:none;">
          <a class="btn btn-ghost" id="shareFb" href="#" target="_blank" rel="noopener">Del på Facebook</a>
          <a class="btn btn-ghost" id="shareLi" href="#" target="_blank" rel="noopener">Del på LinkedIn</a>
        </div>
        <button class="btn" data-close="1" type="button">Avbryt</button>
        <button class="btn btn-primary" id="btnSave" type="button">Lagre</button>
      </div>
    </div>
  </div>

  <div id="mailModal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" data-mail-close="1"></div>

    <div class="modal-panel" role="dialog" aria-modal="true" aria-label="E-postvarsler">
      <div class="modal-header">
        <div class="modal-title">
          <h2>E‑postvarsler</h2>
          <p class="muted">Legg inn e‑poster som skal få varsel ved nye innsendinger.</p>
        </div>

        <button class="icon-btn" data-mail-close="1" aria-label="Lukk">✕</button>
      </div>

      <div class="modal-body">
        <div class="field">
          <label for="mailRecipientsInput">Legg til mottaker</label>
          <div class="recipient-add">
            <input id="mailRecipientsInput" class="input" type="email" placeholder="navn@eksempel.no" />
            <button class="btn" id="btnMailAdd" type="button">Legg til</button>
          </div>
        </div>
        <div class="recipient-list" id="mailRecipientsList"></div>
        <p class="hint" id="mailRecipientsHint"></p>
      </div>

      <div class="modal-footer">
        <button class="btn" data-mail-close="1" type="button">Avbryt</button>
        <div class="spacer"></div>
        <button class="btn btn-primary" id="btnMailSave" type="button">Lagre</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>
  <script type="module" src="./submit.js"></script>
  <script type="module" src="./admin.js"></script>
</body>
</html>
